<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-SFMC AMPScript/ManageSpamComplaints">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">How to manage spam complaints on Salesforce Marketing Cloud | SFMCIFY</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://sfmcify.github.io/docs/SFMC AMPScript/ManageSpamComplaints"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="How to manage spam complaints on Salesforce Marketing Cloud | SFMCIFY"><meta data-rh="true" name="description" content="There are several factors to take into consideration for a successful landing in the inbox. Open rates, bounce rates, ctr and other metrics all reveal a lot about your emails reputation for ISPs and your clients. An important factor we need to keep an eye on is spam complaints rate because it can easily damage your domains and IPs hardly earned reputation."><meta data-rh="true" property="og:description" content="There are several factors to take into consideration for a successful landing in the inbox. Open rates, bounce rates, ctr and other metrics all reveal a lot about your emails reputation for ISPs and your clients. An important factor we need to keep an eye on is spam complaints rate because it can easily damage your domains and IPs hardly earned reputation."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://sfmcify.github.io/docs/SFMC AMPScript/ManageSpamComplaints"><link data-rh="true" rel="alternate" href="https://sfmcify.github.io/docs/SFMC AMPScript/ManageSpamComplaints" hreflang="en"><link data-rh="true" rel="alternate" href="https://sfmcify.github.io/docs/SFMC AMPScript/ManageSpamComplaints" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.73962ecd.css">
<link rel="preload" href="/assets/js/runtime~main.2d47c979.js" as="script">
<link rel="preload" href="/assets/js/main.5f3a6760.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_sfmcify.jpg" alt="SFMCIFY Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_sfmcify.jpg" alt="SFMCIFY Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SFMCIFY</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Categories</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">SFMC Articles</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/sfmc-ampscript">SFMC AMPScript</a><button aria-label="Toggle the collapsible sidebar category &#x27;SFMC AMPScript&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SFMC AMPScript/DataPrivacyManagerAndSFMC">Data Privacy Manager &amp; SFMC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/SFMC AMPScript/ManageSpamComplaints">Manage Spam Complaints</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/sfmc-api">SFMC API</a><button aria-label="Toggle the collapsible sidebar category &#x27;SFMC API&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/sfmc-builders">SFMC Builders</a><button aria-label="Toggle the collapsible sidebar category &#x27;SFMC Builders&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/sfmc-sql">SFMC SQL</a><button aria-label="Toggle the collapsible sidebar category &#x27;SFMC SQL&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/sfmc-ssjs">SFMC SSJS</a><button aria-label="Toggle the collapsible sidebar category &#x27;SFMC SSJS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/sfmc-studios">SFMC Studios</a><button aria-label="Toggle the collapsible sidebar category &#x27;SFMC Studios&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/sfmc-ampscript"><span itemprop="name">SFMC AMPScript</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Manage Spam Complaints</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How to manage spam complaints on Salesforce Marketing Cloud</h1></header><p>There are several factors to take into consideration for a successful landing in the inbox. Open rates, bounce rates, ctr and other metrics all reveal a lot about your emails reputation for ISPs and your clients. An important factor we need to keep an eye on is <strong>spam complaints rate</strong> because it can easily damage your domains and IPs hardly earned reputation.</p><p>In this article, you will learn how to manage email complaints on a multi-business unit organisation on Salesforce Marketing Cloud when using a custom solution for managing consents.</p><p>Before digging into the subject, I want to give an overview about the architecture of the Marketing Cloud account we are using.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sfmc-account-architecture">SFMC account architecture<a class="hash-link" href="#sfmc-account-architecture" title="Direct link to heading">​</a></h2><p>We have two brands we’re going to call <strong>Brand A</strong> and <strong>Brand B</strong> that are running on a multi-org account. At the beginning of the project, we did not have longterm visibility about the client’s needs. So, we decided to work with a basic and simple architecture:</p><p><img loading="lazy" alt="SFMC Architecture connected to Sales Cloud" src="/assets/images/Architecture-bf6499ad65a7dd5a1d18d994c818f261.png" width="600" height="425" class="img_ev3q"></p><p>A parent Business Unit, the only one that was used at that time: Brand A. A second BU, which is a contract’s bonus from Salesforce.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-is-this-architecture-not-convenient">Why is this architecture not convenient?<a class="hash-link" href="#why-is-this-architecture-not-convenient" title="Direct link to heading">​</a></h3><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>I would not recommend using this architecture for many reasons. Some are explained below, and some are not. What I suggest is using the parent BU as an Admin BU and use child BUs for your brands if you have many. This way, you will avoid a lot of headaches in the future..</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>We can’t use the business-level unsubscribes standard functionality at the parent BU. Remember that our parent BU represents our Brand A.</p></div></div><p>This functionality is available at <code>Properties</code> settings of a Business unit. We have to choose between these two options:</p><ol><li>Subscribers will be unsubscribed from all business units in the Enterprise</li><li>Subscribers will be unsubscribed from this business unit only</li></ol><p>The problem is, we don’t have a choice at the parent BU. SFMC forces you to choose the first option. This will result in an unwanted behaviour: </p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>A contact will no longer receive emails from <strong>Brand B</strong> if he unsubscribes from a <strong>Brand’s A</strong> email.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="feedback-loops">FeedBack Loops<a class="hash-link" href="#feedback-loops" title="Direct link to heading">​</a></h2><p>There are two ways a recipient can use to unsubscribe from emails. He can either click the unsubscribe link on the email, or make use of the “Mark as spam” button in the inbox.</p><p>It’s important to understand how spam complaints are handled by Marketing Cloud because, depending on how we are managing consents, we might adjust the standard handling process.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="isp-feedback-loops-for-marketing-cloud">ISP Feedback Loops for Marketing Cloud<a class="hash-link" href="#isp-feedback-loops-for-marketing-cloud" title="Direct link to heading">​</a></h3><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>A feedback loop (FBL) is a service provided by some ISPs to let recipients inform senders that a given email is unwanted (by letting the user hit the “This is spam” button on his email client).</p></div></div><p>After the click on this button, an “FBL” complaint is sent back to Marketing Cloud. Once processed, the recipient will be marked as unsubscribed on AllSubscribers and the complaint is logged in the <a href="https://help.salesforce.com/articleView?id=mc_as_data_view_complaint.htm&amp;type=5" target="_blank" rel="noopener noreferrer">Complaint data view</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="do-all-isps-have-feedback-loops">Do all ISPs have Feedback loops?<a class="hash-link" href="#do-all-isps-have-feedback-loops" title="Direct link to heading">​</a></h3><p>As stated in <a href="https://help.salesforce.com/articleView?id=000353531&amp;type=1&amp;mode=1" target="_blank" rel="noopener noreferrer">this article</a>, All Marketing Cloud clients are signed up for the ISP feedback loops below automatically. Salesforce Marketing Cloud bulk-registers all of its sending IP address ranges with these ISP feedback loops:</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Bluetie (Excite), Comcast, Cox, Fastmail, Microsoft Hotmail, Italia Online, La Poste, Liberty Global, Locaweb, Mail.ru, OpenSRS (Tucows), Rackspace (Mailtrust), Seznam, Synacor, Telenor, Telstra, Terra, UOL (Brazil), USA.net, XS4ALL, and Yandex</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>We see Microsoft Hotmail on the list, but it’s important to know that FBL for <em>Outlook Desktop version</em> is not offered by Microsoft. <strong>This was confirmed by the SFMC’s support</strong>.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="i-cant-see-yahoo-on-the-list-what-about-them">I can’t see Yahoo on the list, what about them?<a class="hash-link" href="#i-cant-see-yahoo-on-the-list-what-about-them" title="Direct link to heading">​</a></h3><p>As explained in <a href="https://help.salesforce.com/articleView?language=en_US&amp;type=1&amp;mode=1&amp;id=000312472" target="_blank" rel="noopener noreferrer">this article</a>, Yahoo Mail’s Feedback Loop requires that all mail be signed with DKIM. Which means, we need to have <strong>Private Domain</strong> or <strong>Sender Authentication Package</strong> on our account because it’s necessary to sign all mail with DKIM (DomainKeys Identified Mail) authentication.</p><p>In our case, we have SAP and private domains on both BUs. We followed the statement in the article saying:</p><blockquote><p>If you have a sending domain configured as a Private Domain with Marketing Cloud, please reach out to support to have the domain registered for the Yahoo FBL.</p></blockquote><p>We’ve created an email asking the support to activate this feature, but it appears that it’s enabled automatically for private domains as well as SAP. Anyway, I recommend you asking them to enable it for you, who knows ..</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-about-gmail">What about Gmail?<a class="hash-link" href="#what-about-gmail" title="Direct link to heading">​</a></h3><p>Google has a different mechanism that does not function like a standard FBL. They call it GFL (Gmail Feedback Loop). It offers a high level reputation related statistics through their tool “Gmail Postmaster Tools”. Unlike other ISPs, SFMC does not register its clients domains with Gmail Postmaster Tools. </p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>You can check this <a href="https://help.salesforce.com/articleView?id=000313363&amp;type=1&amp;language=en_US" target="_blank" rel="noopener noreferrer">enrollment guide</a> to register for GFL. </p></div></div><p>I’ve done some tests (we are in 2018), and it appears that if a recipient clicks on the “Mark as spam” button, it will not be logged in <code>Complaints</code> data view, but unlike what it is said in the SFMC documentation, the recipient will be <strong>marked as unsubscribed</strong> in AllSubscribers.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-handle-complaints-on-salesforce-marketing-cloud">How to handle complaints on Salesforce Marketing Cloud?<a class="hash-link" href="#how-to-handle-complaints-on-salesforce-marketing-cloud" title="Direct link to heading">​</a></h2><p>Handling complaints depends on our SFMC architecture and how are we handling consents. In our case, we moved consents logic outside of AllSubscribers. </p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>You can check out <a href="/docs/SFMC AMPScript/DataPrivacyManagerAndSFMC">this article</a> where I explain a way to manage Data Privacy between Sales and Marketing Clouds.</p></div></div><p>We are using a Sales Cloud plugin called Data Privacy Manager to handle consents. A custom field is created on Lead, Account and Contact objects. Each consent is represented by a unique auto-generated six digit code. For example, if we have two types of communications for our contacts, let’s call them <code>Newsletter</code> and <code>SpecialOffers</code>, they will have the ids 100001 &amp; 100002. These values are concatenated into the field and separated by a comma.</p><p>On the SFMC side, each consent will be represented by a boolean field on our <code>Consent</code> data extension. It should look like below:</p><table><thead><tr><th>Field Name</th><th>Field Type</th><th>Length</th><th>Default Value</th></tr></thead><tbody><tr><td>SubscriberKey</td><td>Text</td><td>18</td><td></td></tr><tr><td>NewsletterEmail_Consent</td><td>Boolean</td><td>False</td><td>False</td></tr><tr><td>SpecialOffersEmail_Consent</td><td>Boolean</td><td>False</td><td>False</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-todays-complaints-from-complaints-data-view">Getting today’s complaints from Complaints data view<a class="hash-link" href="#getting-todays-complaints-from-complaints-data-view" title="Direct link to heading">​</a></h3><p>Salesforce Marketing Cloud provides a data view to check <a href="https://help.salesforce.com/articleView?id=mc_as_data_view_complaint.htm&amp;type=5" target="_blank" rel="noopener noreferrer">complaints</a> data related to emails from our BUs. By querying this data view, we can get spam complaints from our subscribers about our emails sends for the last six months.</p><p>To get today’s complaints, we will be creating an automation with two activities. An SQL query to get data, and a Script activity to update consents on Sales Cloud.</p><p>The automation will be scheduled to run daily at 5AM. The schedule time depends on other automations on our account. </p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>I would suggest scheduling this automation early in the morning so that “complainers” are excluded from that day’s communications as well.</p></div></div><p><strong>BRAND_A_COMPLAINTS Data Extension</strong></p><p>We need a data extension to store complaints in our socle. Let’s go with this format:</p><table><thead><tr><th>Field Name</th><th>Field Type</th><th>Length</th><th>Default Value</th></tr></thead><tbody><tr><td>SubscriberKey</td><td>Text</td><td>18</td><td></td></tr><tr><td>JobID</td><td>Number</td><td></td><td></td></tr><tr><td>Email_Name</td><td>Text</td><td>500</td><td></td></tr><tr><td>Domain</td><td>Text</td><td>128</td><td></td></tr><tr><td>AccountID</td><td>Number</td><td></td><td></td></tr><tr><td>OYBAccountID</td><td>Text</td><td>50</td><td></td></tr><tr><td>Event_Date</td><td>Date</td><td></td><td></td></tr><tr><td>Secret</td><td>Number</td><td>1</td><td></td></tr></tbody></table><p>You should be asking, why do we need the OYBAccountID and Secret fields? Good question. In our case, we have two business units, each business unit represents a different brand and have its own domains and IP addresses. And since AllSubscribers is shared between BUs as well as Complaints data view, complaints from all business units will be regrouped in this data view, <em><strong>we don’t want a subscriber that complaints about a BrandA’s email to be considered as a BrandB’s complainer.</strong></em></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p><code>AllSubscribers</code> is shared between all BUs of an SFMC instance. The same applies for <code>Complaints</code> data view, complaints from all business units will be regrouped in this data view.</p></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p><strong>OYBAccountID</strong> is a field in our data view that is populated automatically by Marketing Cloud <strong>only</strong> if the complaint is from a child BU. Hence, if a complaint is from our child BU, we can use OYBAccountID to determine from which consents we need to unsubscribe the complainer.</p></div></div><p>I’ll be explaining the utility of “Secret” field later on.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sql-query-to-get-complaints">SQL Query to get complaints<a class="hash-link" href="#sql-query-to-get-complaints" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">comp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SubscriberKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">comp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jobid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eventdate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">emailname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Domain</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ISNULL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">comp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OYBAccountID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">comp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AccountID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> OYBAccountID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">comp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AccountID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> _Complaint comp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> _job j </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> comp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jobid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jobid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">convert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">date</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> comp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">eventdate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> dateadd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">day</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> datediff</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">day</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> getdate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">convert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">date</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> comp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">eventdate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> getdate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OYBAccountID </span><span class="token operator" style="color:#393A34">IS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> OYBAccountID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50000</span><span class="token plain">XXXX</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OYBAccountID </span><span class="token operator" style="color:#393A34">IS</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When <strong>OYBAccountID</strong> is null, which will always be the case when running the query from the parent BU, the ISNULL function populates it with the AccountID. We use <code>Datediff</code> function to get yesterday’s date and compare it with today’s date.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="automation-to-update-consents-on-sales-cloud">Automation to update consents on Sales Cloud<a class="hash-link" href="#automation-to-update-consents-on-sales-cloud" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="run-amscript-in-a-script-activity-in-automation-studio">Run AMScript in a Script Activity in Automation Studio<a class="hash-link" href="#run-amscript-in-a-script-activity-in-automation-studio" title="Direct link to heading">​</a></h4><p>After marking an email as spam, the contact is marked as Unsubscribed in AllSubscribers. This is not enough in our case because we are relying on a data extension to manage our contacts’ consents. We need to update consents on Sales Cloud using the mechanism described <a href="/docs/SFMC AMPScript/DataPrivacyManagerAndSFMC">here</a>.</p><p>To unsubscribe a contact, we need to use the AMPScript function <strong>CreateSalesforceObject</strong> to create a Task on Sales Cloud with specific texts in the subject and comments fields.</p><p>But, as you might already know, Script activities work only with SSJS. Hence, we have two options here: use AMPScript directly in our script activity using concatenation and TreatAsContent function (which I recommend only if your code is simple and not too long) . Or, using this way:</p><ul><li>Create a Code Snippet content block in Content Builder</li><li>Add our AMPScript to it</li><li>Execute the AMPScript from the Script Activity using SSJS’s platform function <strong>ContentBlockByKey</strong></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="code-snippet-code">Code Snippet code<a class="hash-link" href="#code-snippet-code" title="Direct link to heading">​</a></h4><p>This code starts with a lookup on our <code>BRAND_A_COMPLAINTS</code> data extension hosting all our complaints of the day. </p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Use the field <strong>Secret</strong>, which is a number field with a default value of 1, as an always true condition in a lookup to get all records of a data extension. It’s a sort of a workaround.</p></div></div><p>Then, we are getting the subscriberkey of the complainer and creating a task on Sales Cloud with the specific texts in the subject and comments. In this case, we are unsubscribing contacts from all email communications.</p><p>At the end, we are logging subscriberkeys and the date of the unsubscriptions.</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">%</span><span class="token operator" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> @rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @row</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @rowCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @subKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @rows </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">LookupRows</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BRANDA_COMPLAINTS&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;OYBAccountID&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;50000XXXX&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;Secret&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @rowCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rowcount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> @rowCount </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> then </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> @counter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> to @rowCount </span><span class="token keyword control-flow" style="color:#00009f">do</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set @row </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">row</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @counter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set @subKey </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@row</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;SubscriberKey&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set @created_taskId</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">CreateSalesforceObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Task&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;WhoId&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @subKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Subject&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Datapm:Unsubscribe&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Description&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;channel&quot;:&quot;email&quot;}&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function maybe-class-name" style="color:#d73a49">InsertDE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;COMPLAINTS_LOG&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;SubscriberKey&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @subKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;Event_Date&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">FormatDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function maybe-class-name" style="color:#d73a49">Now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;iso&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">%</span><span class="token operator" style="color:#393A34">%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="script-activity-code">Script activity code<a class="hash-link" href="#script-activity-code" title="Direct link to heading">​</a></h4><p>In the script activity, we are using the <code>ContentBlockByKey</code> function to execute our AMPScript. Don’t forget to replace <code>YOUR_CONTENTBLOCK_KEY</code> by your Code Snippet key. We can use <code>ContentBlockByName</code> or <code>ContentBlockById</code> functions as well.</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">script runat</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;server&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> ampscriptCode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token known-class-name class-name">Function</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">ContentBlockByKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;YOUR_CONTENTBLOCK_KEY&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">script</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We discovered a <strong>technical</strong> way to handle complaints when using a custom consents management solution. We need to understand that if the percentage is high (it is said that a bad rate would be above 0.3%), we might consider checking our emailing strategy (content and frequency) because at the end, the source of the problem is what needs to be fixed.</p><p>Next time, I’ll be writing about how to handle complaints from ISPs that are not handled by default by Marketing Cloud. Let me know if this would be interesting, and don’t forget, all comments and suggestions are welcome.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/spam-complaints">Spam complaints</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/gdpr">GDPR</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/amp-script">AMPScript</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/marketing-cloud-connect">MarketingCloud Connect</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/SFMC AMPScript/DataPrivacyManagerAndSFMC"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Data Privacy Manager &amp; SFMC</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/sfmc-api"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SFMC API</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#sfmc-account-architecture" class="table-of-contents__link toc-highlight">SFMC account architecture</a><ul><li><a href="#why-is-this-architecture-not-convenient" class="table-of-contents__link toc-highlight">Why is this architecture not convenient?</a></li></ul></li><li><a href="#feedback-loops" class="table-of-contents__link toc-highlight">FeedBack Loops</a><ul><li><a href="#isp-feedback-loops-for-marketing-cloud" class="table-of-contents__link toc-highlight">ISP Feedback Loops for Marketing Cloud</a></li><li><a href="#do-all-isps-have-feedback-loops" class="table-of-contents__link toc-highlight">Do all ISPs have Feedback loops?</a></li><li><a href="#i-cant-see-yahoo-on-the-list-what-about-them" class="table-of-contents__link toc-highlight">I can’t see Yahoo on the list, what about them?</a></li><li><a href="#what-about-gmail" class="table-of-contents__link toc-highlight">What about Gmail?</a></li></ul></li><li><a href="#how-to-handle-complaints-on-salesforce-marketing-cloud" class="table-of-contents__link toc-highlight">How to handle complaints on Salesforce Marketing Cloud?</a><ul><li><a href="#getting-todays-complaints-from-complaints-data-view" class="table-of-contents__link toc-highlight">Getting today’s complaints from Complaints data view</a></li><li><a href="#automation-to-update-consents-on-sales-cloud" class="table-of-contents__link toc-highlight">Automation to update consents on Sales Cloud</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/AboutMe">About me</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://salesforce.stackexchange.com/users/41888/rachid-mamai" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Exchange<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/rachid-mamai-142985b6/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/MamaiRachid" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Attribution">Attribution</a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.2d47c979.js"></script>
<script src="/assets/js/main.5f3a6760.js"></script>
</body>
</html>